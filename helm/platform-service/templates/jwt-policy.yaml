# v1 - should we support multiple origins?
{{- if not .Values.deploymentOnly -}}
{{- if .Values.jwt.createPolicy -}}
apiVersion: "authentication.istio.io/v1alpha1"
kind: "Policy"
metadata:
  name: {{ include "platform-service.name" . }}-jwt-policy
spec:
  targets:
  - name: {{ include "platform-service.name" . }}
  peers:
  - mtls: {}
  origins:
  - jwt:
      issuer: {{ .Values.jwt.issuer }}
      jwksUri: {{ .Values.jwt.jwksUri }}
  principalBinding: USE_ORIGIN
{{- end }}
{{- end }}
